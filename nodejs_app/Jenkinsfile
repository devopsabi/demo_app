pipeline {
        agent any
        
        stages {
        
            stage('checkout_nodejs_app') {
                steps {
                    git branch:"master", url: '', credentialsId:'git_hub_id'
                }
    
            }

		
         stage('build docker image nodejs_app'){
                steps {
                    script{
			
                        withDockerRegistry(url:'',credentialsId:'docker_hub_id'){
                            docker.build('devopsabi/demo_app:'+currentBuild.number).push()
                            exit_status = sh(script: 'uptime')
                            println "${exit_status}"

                           }
                    }
                }
            }
            

	    stage('Test Run') {
            	steps {
                	retry(3) {
                  	  sh './run.sh'
               		 }

                	timeout(time: 3, unit: 'MINUTES') {
                    		sh './health-check.sh'
               		 }
            	}
	    }

    }
}
